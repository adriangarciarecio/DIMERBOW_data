# Generation of all possible dimers
## Pipeline

**gen_oligos.py** (250 lines, 5 functions)


- Takes the list of GPCR XRAY structures from the LMCDB (internal MySql database)
- Generates the symmetry mates using Pymol
- Does a first filtering of dimers:
  - dimers are in the same plane based on OPM (https://opm.phar.umich.edu/) positioning (distance between centers  in the Z-directoin > 10 A.
  - maximum distance between centers > 48 A
  - angle (normal to the membrane) between dimers < 30ยบ
- The output is a collection of .pse files (140 files, May 10, 2018 )

**gen_dimers.py** (312 lines, 5 functions)

Generate the dimers using the PyMol sessions (.pse format) generated by gen_oligos.py


- Opens the list of sessions generated by gen_oligos.py (extension .pse)
- Generates all possible pairs of monomers (dimers) without filtering (503 dimers, May 10, 2018) using only the chains of the dimers (remove chains like peptides present in the session)  
- Does three steps of filtering on all generated dimers:
  - 1) Remove the fusion-protein according to specific coordinates in each structure and remove atoms around 8 A of the dimer 
  - 2) Remove the structures with the separation between the center-of-mass of the two protomers < 10 A(only select CA) (197 dimers, May 10, 2018)
  - 3) Remove dimers of the same protein with the same topology (rmsd of CA <=3 nm2). Keep the structure with the best resolution (77 dimers, May 10, 2018).
- Use `pdb_mappings.txt, fusion_residues.txt` and `list_pdb_resol.txt` files.
- Generate too gooddimers.txt, topology.txt and removed.txt like control files.

**gen_distribution.py** (220 lines, 12 functions)

Represent the distribution of the interfaces by superposing all the dimer structures on a reference (and rename the dimers for convenience to `XXXX_YYYY_ZZ`, where XXX is the PDB ID, YYYY is the Uniprot Entry Name without the organism part and ZZ is an identifier). 


- Superpose both chains in the dimer (i.e. A to Aref and Q to Aref) 
- Calculate the vectors using the center of mass (point) to determine the azimutal angle (compare Vref to Vaq) .
- Compare the azimutal angles and remove the repeated ones related with symetric and asymetric (abs(angle1 - angle2) < 5 A) 
- Label each point (PDBID_UniprotAcession) 
- Generate `distributions.pse` and `nostructures.pse` to show all dimers in Pymol.


# Generation and preparation of the simulations
## Pipeline

**gen_groups.py** (32 lines)

Divides the total number of systems in sets that well be sent together for simulation. 


- Generate `group_x.txt` files to group dimers.

**dimer_simulations.sh** (207 lines) 

Generate, prepares and runs the molecular dynamics simulations of each dimer in separate directories.


- `gen_directories.py` generates the directories where the files used or generated by the script of each dimer are stored.
- `a_pdbAddTER.py` add the TER names to each chain in pdb generated by `gen_dimers.py` before the simulation and get the input file with the two chains differentiated.
- `martinize.py` and `insane.py` are MARTINI Coarse Grained scripts to generate Martini protein topology and structure files based on an atomistic structure file and setup Martini bilayer systems, respectively (http://www.cgmartini.nl/index.php/tools2/proteins-and-bilayers).
- `write_martini.py` rewrite Martini files with specifications by the user.
- Generate `stderr_x.log` and `stdout_x.log` to control the process.

Example:
`(bash dimer_simulations.sh group_x.txt > stdout_x.log) >& stderr_x.log`

**a_cg2fg.py** (32 lines)
Converts the protein part of the PDB (one snapshot only) to atomistic using program PULCRHA (requires manual installation,  http://cssb.biology.gatech.edu/skolnick/files/PULCHRA/index.html)

Example:
`a_cg2fg.py xxxx.pdb` 
`pymol pulchra xxxx_AT.pdb *.rebuilt.pdb` 

## Analysis of the simulations
# Pipeline

**get_interactions.py** (1059 lines, 27 functions)

Get the interactions of each .pdb or .gro file used in simulations. 


- For each dimer, generate an output text file with the list of each interaction between the two protomers. Example:
      `A_O_ALA_59_ICL1 B_SG_CYS_341_CT 4.01 -17.88199997 PH` 
      a   b     c     d      e     f    g      h       i       j       k               l              m
  - a, f: Chain.
  - b, g: Atom type
  - c, h: Residue name
  - d, i: Residue Id
  - e, j:  Localization
  - k: Distance (ร).
  - l: Height on the Z-axis (average of the z coordinates of each atom).
  - m: Type of interaction (Hydrophobic, Polar, Charged or Aromatic) 
  
- After the generation of the files the script generates files with the counting of this interactions by zone (count_interactions.py).

**gen_trajectory.sh** (87 lines)

Recenter the trajectories one the first protomer.

**martini_to_atom.sh** (18 lines)

Convert a structure in Coarse-grained MARTINI model to atomistic. 

- Use the script `add_chain_letters.py` to recover the name of each chain. 

**get_angle.py** (132 lines, 3 functions)

Calculates the azimuthal angles of each dimer at the time point indicated by the user and the distance between protomers.

**get_rmsd.py** (68 lines)

Calculates the RMSD of each dimer at the time point indicated by the user.

**plot_results.R** (1650 lines) 

Manipulate and generate all the tables and plots that represents the results of the analysis. 

- All the collected data used in the package "web_dimers" becomes from here. 

